
function tpsChannel(options){this.options=options||{};this.channel=this.options.channel||[];this.subscribers=this.options.subscribers||[];this.subscriberTimeout=this.options.subscriberTimeout||0;this.channelThreshold=this.options.channelThreshold||null;this.psTimeout=null;this.isub=this.options.isub||false;this.init();};tpsChannel.prototype={init:function(){if(this.channel.length>0){this.callSubscribers();}},subscribe:function(callback){if(this.subscribers.indexOf(callback)==-1){this.subscribers.push(callback);}},unsubscribe:function(callback){this.subscribers.splice(this.subscribers.indexOf(callback),1);},update:function(objs){this.channel=objs;this.callSubscribers();},push:function(obj){if(Object.prototype.toString.call(obj)==='[object Array]'){this.channel=this.channel.concat(obj);}else{this.channel.push(obj);}
this.callSubscribers();},resetChannel:function(){this.channel=[];},callSubscribers:function(){if(this.psTimeout!=null){clearTimeout(this.psTimeout);}
var accessor=this;if(this.channelThreshold!=null&&this.channel.length>=this.channelThreshold){accessor._callSubscribers(accessor.subscribers);}else{this.psTimeout=setTimeout(function(){accessor._callSubscribers(accessor.subscribers);},this.subscriberTimeout);}},_callSubscribers:function(subscribers){var index=subscribers.length;while(index--){if(this.isub==true){for(i=0;i<this.channel.length;i++){subscribers[index](this.channel[i]);}}else{subscribers[index](this.channel);}}
this.resetChannel();}};